-----------------------------------------------------------------------------------------------------------------------------------------
      name:  main
       log:  E:\Research Projects\Worker Accidents and Pollution\Regression Models\traffic_summary_statistics.log
  log type:  text
 opened on:   8 Mar 2021, 19:06:00

. 
. * Import the clean data file, produced using R. I'm using Stata for the analysis.
. * because Stata works with panel data a little easier.
. import delimited "../Data/Data for Regression Models/`industry'_accidents_2003_to_2015.csv", varnames(1) numericcols(3/25)
(18 vars, 15,321,630 obs)

. 
. ********* End of section to change when switching between local and ACCRE ******
. 
. ********* Basic fixes to data file, applicable to every regression *************
. 
. * Replace the string date variable with one readable by Stata.
. gen temporary_date = date(date, "YMD")

. drop date

. rename temporary_date date

. format date %td

. 
. * Create a month variable so I can absorb month-of-year fixed effects
. gen month = month(date)

. 
. // * Create weekday dummy variables, since ivreg2 can't handle factor variables
. // tabulate weekday, generate(weekday_dummy_)
. // drop weekday_dummy_1
. 
. * Drop any observations from Alaska, Hawaii, or Puerto Rico.
. drop if floor(fips / 1000) == 2 | floor(fips / 1000) == 15 | floor(fips / 1000) == 72
(531,883 observations deleted)

. 
. * Drop any duplicates on fips and date, since multiple accidents may occur in the same county on the same day
. * but I just want a dummy for whether an accident occurred. We can worry about numbers of accidents later
. duplicates drop fips date, force

Duplicates in terms of fips date

(32,963 observations deleted)

. 
. * Declare the data as panel data.
. xtset fips date
       panel variable:  fips (strongly balanced)
        time variable:  date, 01jan2003 to 31dec2015
                delta:  1 day

. 
. * Generate heating- and cooling-degree-day measurements to capture the fact that
. * temperature changes could plausibly have very different effects depending
. * on the base temperature; but first, transform from kelvin to celsius
. replace mean_temperature = mean_temperature - 273.15
(14,756,784 real changes made)

. gen heat_degree_days = mean_temperature - 18 if mean_temperature > 18
(8,893,687 missing values generated)

. replace heat_degree_days = 0 if heat_degree_days == .
(8,893,687 real changes made)

. gen cool_degree_days = 18 - mean_temperature if mean_temperature < 18
(5,863,097 missing values generated)

. replace cool_degree_days = 0 if cool_degree_days == .
(5,863,097 real changes made)

. 
. ********* End basic fixes to data file, applicable to every regression *********
. 
. gen season = .
(14,756,784 missing values generated)

. replace season = 4 if month == 12 | month == 1  | month == 2
(3,645,684 real changes made)

. replace season = 1 if month == 3  | month == 4  | month == 5
(3,717,168 real changes made)

. replace season = 2 if month == 6  | month == 7  | month == 8
(3,717,168 real changes made)

. replace season = 3 if month == 9  | month == 10 | month == 11
(3,676,764 real changes made)

. 
end of do-file

. tab season

     season |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |  3,717,168       25.19       25.19
          2 |  3,717,168       25.19       50.38
          3 |  3,676,764       24.92       75.29
          4 |  3,645,684       24.71      100.00
------------+-----------------------------------
      Total | 14,756,784      100.00

. exit, clear
